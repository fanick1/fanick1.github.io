<!doctype html>

<html>

	<head>
	
	</head>
	
	

	<body>
		<script>
                'use strict';
                
                navigator.serviceWorker.register('/sw.js')
                var notifier = null;
                Notification.requestPermission(function(result) {
    	            if(result === 'granted'){
                                navigator.serviceWorker.ready.then(function(registration){
                                        notifier = registration
                                })
                    }
                })

		var pauzetimer = function(timeout){
			console.debug(new Date().toLocaleTimeString(), ' new timeout: ', timeout);
			
			setTimeout(function(){
				var n = notifier.showNotification('PAUZE ',{body:' Have a break ! \r\n \r\nClick to restart ', requireInteraction: true, icon:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAkFBMVEX///8EAgR0cnR8enz8/vxkZmT8+vxUVlT09vR0dnTU1tTk5uRsbmyUlpT08vRUUlQUEhRcXlwUFhTExsQcHhycmpykpqScnpzs6uzs7uy8urwMDgwsKiw0NjS8vrwkIiSEhoREQkSsqqx8fnxcWlxERkQkJiQ8Pjw0MjQsLixkYmTc2tyMioxMTkzMysxMSkx3av1DAAABoElEQVRYhcWWyXLCMBBENUbY8s5iYwhgdgiQkP//u0jyIYFEYxddqfTFF/ohzaYR4u8lfRQwAQHXEASEHuaf0hryyw+KIEBJhUT8N6Ie4lcroisCuBANkBtERJQjB+hrQAD45UADzgDAJ6MYOIEFIJV8sASgEtcW8Pp8ItXIEtLnjzCxgAEwkwJLeHkeMJsbANJPoQEkAMC0AyFT0VYjMpdNNc6Rl2GqASXgFxXRCRqKAc2BdhQig6pIK4VSqDVcgG/zscb8YgllQAuLoBa6nfyP3nqMqnZ/85o41Z6VDABI35ciZv0FY49y84vlkgW8M3cvaJXWQ/4C3Hi90THTt9jwgLUbsKVt82E1dgPGNDUfxQMyNyBrAGLE+dmN69BM/xMHYBemutkDcg6w4wByH5jmXXCAGwcQarOoYjYLbUun3HFu6rJvXdkIdNr4or3bP3QePfS+6ewE5N6dwq+IyLhs66JHXdL4IaIqZWvwTqP012mtko7+RLmCUa862AvutVNeq99z/n2jKGDtQYfNe1a5GEE5a7dbjZP+TyW/TqNPMPUSATnWmhsAAAAASUVORK5CYII='})
					/*	.then(function(notificationEvent){
							console.debug('event:', notificationEvent);
							debugger;
						})*/
/*				n.onclick=function(){
					n.close();
					window.focus();
					setTimeout(function(){
						var _timeout = prompt('Timer restarted. Specify new timeout (in minutes).');
						pauzetimer(_timeout);
						},0);
				};*/
			}, (timeout * 60 * 1000) || 100);
		 };
		 
		 navigator.serviceWorker.onmessage = function(messageEvent){
		     console.log("Received message: ", messageEvent.data);
		     if(messageEvent.data.clicked){
			window.focus();
			setTimeout(function(){
				var _timeout = prompt('Timer restarted. Specify new timeout (in minutes).');
				pauzetimer(_timeout);
				},0);
		     }
		 }
		</script>
	<button onclick="pauzetimer()">Start timer</button>
	</body>

</html>
